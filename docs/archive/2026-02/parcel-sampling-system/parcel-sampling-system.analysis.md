# Gap Analysis: parcel-sampling-system

> 분석일: 2026-02-25
> 기준 문서: `docs/plan-representative-parcel.md`, `docs/tasks-representative-parcel.md`
> 대상: 농업환경변동조사 필지 추출 시스템 (봉화군)

---

## Match Rate

```
요구사항 (F-01~F-10):  10/10 = 100%
태스크   (T-01~T-15):  14/15 =  93%
종합     (F+T 통합):   24/25 =  96%
```

---

## 요구사항별 판정 (F-01 ~ F-10)

| 번호 | 요구사항 | 판정 |
|------|----------|------|
| F-01 | 대표필지 엑셀 파일 별도 업로드 슬롯 | ✅ |
| F-02 | 대표필지 파일에 컬럼 매핑 적용 가능 | ✅ |
| F-03 | 대표필지는 마스터 파일과 매칭 불필요 | ✅ |
| F-04 | 총 목표 700에 대표필지 포함, 공익직불제 추출 목표 자동 차감 | ✅ |
| F-05 | 결과 테이블에서 공익직불제/대표필지 배지 표시 | ✅ |
| F-06 | 지도에서 대표필지 마커 초록색(#059669) | ✅ |
| F-07 | 지도 범례에 대표필지 항목 추가 | ✅ |
| F-08 | 마커 클릭 상세 패널에 카테고리 표시 | ✅ |
| F-09 | 엑셀 내보내기 시 별도 시트 | ✅ |
| F-10 | 대표필지 파일 미등록 시 기존 기능 정상 동작 | ✅ |

---

## 태스크별 판정 (T-01 ~ T-15)

| 태스크 | 제목 | 판정 |
|--------|------|------|
| T-01 | Parcel 타입에 parcelCategory 필드 | ✅ |
| T-02 | excelParser에 카테고리 파라미터 | ✅ |
| T-03 | parcelStore에 대표필지 상태 | ✅ |
| T-04 | extractionStore에 effectiveTarget | ✅ |
| T-05 | UploadPage에 대표필지 슬롯 | ✅ |
| T-06 | MappingPage에서 대표필지 매핑 | ✅ |
| T-07 | AnalyzePage에서 대표필지 파싱 | ✅ |
| T-08 | ExtractPage에 대표필지 정보 | ✅ |
| T-09 | KakaoMap 마커 색상 | ✅ |
| T-10 | MapLegend 대표필지 항목 | ✅ |
| T-11 | ResultTable 카테고리 배지 | ✅ |
| T-12 | ReviewPage 상세 패널 | ✅ |
| T-13 | excelExporter 대표필지 시트 | ✅ |
| T-14 | ExportPage 대표필지 전달 | ✅ |
| T-15 | 전체 흐름 통합 테스트 | ❌ |

---

## Gap 목록

### Gap-1: T-15 전체 흐름 통합 테스트 (❌ 미구현)

- 프로젝트에 테스트 파일이 0개
- 시나리오 A(대표필지 포함)와 시나리오 B(대표필지 미포함) 모두 자동화 테스트 없음
- 영향도: 높음 — 회귀 위험 존재

---

## 품질 이슈 (6건)

| ID | 심각도 | 내용 |
|----|--------|------|
| QI-1 | 낮음 | MappingPage 대표필지 전용 안내 문구 누락 |
| QI-2 | 매우 낮음 | 대표필지 파일 연도가 2026으로 고정 |
| QI-3 | 낮음 | 개별 시트에 '구분' 컬럼 미포함 (별도 시트 분리로 대체) |
| QI-4 | **중간** | extractionStore의 toggleParcelSelection/removeParcel에 대표필지 보호 로직 없음 |
| QI-5 | 정보성 | PNU 생성기가 계획서에 없는 추가 기능 (잘 통합됨) |
| QI-6 | 낮음 | 전체필지 시트의 대표필지 중복 가능성 (현재 아키텍처에서는 문제 없음) |

---

## 추가 기능 (계획서 외)

### PNU 자동 생성기 (`src/lib/pnuGenerator.ts`)

- 봉화군 전용 EUMRI_MAP (10개 읍면, 76개 리)
- 읍면동/리/본번/부번 → 19자리 PNU 코드 생성
- AnalyzePage에 PNU 생성 버튼 UI 추가
- 공익직불제 + 대표필지 모두 PNU 생성 대상
- 산 번지 자동 감지, 기존 PNU 보존 옵션

---

## 권장 개선 사항 (우선순위)

1. **통합 테스트 추가** (Gap-1) — Vitest 설정 + 시나리오 A/B 테스트
2. **대표필지 보호 로직 강화** (QI-4) — store 레벨 가드 추가
3. MappingPage 안내 문구 추가 (QI-1) — 대표필지 매핑 시 전용 안내
